<!DOCTYPE html>
<html lang="bn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>শিক্ষার্থীদের পারফর্ম্যান্স ড্যাশবোর্ড</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --success: #4cc9f0;
        --danger: #f72585;
        --warning: #f8961e;
        --info: #4895ef;
        --science: #4cc9f0;
        --business: #7209b7;
        --arts: #f8961e;
        --light: #f8f9fa;
        --dark: #212529;
        --bg-color: #f5f7fa;
        --container-bg: white;
        --text-color: #333;
        --heading-color: #2c3e50;
        --border-color: #ddd;
        --card-bg: #f8f9fa;
        --shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        --card-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }

      .dark-mode {
        --primary: #5a70f0;
        --secondary: #4f47d4;
        --success: #5dd3ff;
        --danger: #ff4d94;
        --warning: #ffaa4d;
        --info: #5da5ff;
        --science: #5dd3ff;
        --business: #9d4edd;
        --arts: #ffaa4d;
        --light: #343a40;
        --dark: #f8f9fa;
        --bg-color: #121212;
        --container-bg: #1e1e1e;
        --text-color: #e0e0e0;
        --heading-color: #ffffff;
        --border-color: #444;
        --card-bg: #2d2d2d;
        --shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        --card-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', 'SolaimanLipi', Tahoma, Geneva, Verdana, sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
        padding: 0;
        direction: ltr;
      }

      /* হেডার স্টাইল */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: var(--container-bg);
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: var(--card-shadow);
      }

      .header h1 {
        color: var(--heading-color);
        font-size: 1.5rem;
      }

      .header-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      /* কার্ড স্টাইল */
      .card {
        background-color: var(--container-bg);
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        padding: 15px;
        margin-bottom: 20px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .card-title {
        font-size: 1.2rem;
        color: var(--heading-color);
        font-weight: 600;
      }

      /* কন্ট্রোল স্টাইল */
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
      }

      select,
      button,
      input {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        background-color: var(--container-bg);
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
      }

      button {
        background-color: var(--primary);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      button:hover {
        background-color: var(--secondary);
        transform: translateY(-2px);
      }

      select:focus,
      button:focus,
      input:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
      }

      /* চার্ট কন্টেইনার */
      .chart-container {
        position: relative;
        height: 350px;
        margin-bottom: 20px;
        padding: 15px;
        background-color: var(--container-bg);
        border-radius: 8px;
        box-shadow: var(--card-shadow);
      }

      /* পরিসংখ্যান কার্ড */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }

      .stat-card {
        background-color: var(--card-bg);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid var(--primary);
        box-shadow: var(--card-shadow);
        transition: transform 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-3px);
      }

      .stat-value {
        font-size: 22px;
        font-weight: bold;
        color: var(--heading-color);
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 12px;
        color: var(--text-color);
        opacity: 0.8;
      }

      /* গ্রুপ ফিল্টার */
      .group-filters {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .group-btn {
        padding: 6px 12px;
        background-color: var(--card-bg);
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.85rem;
      }

      .group-btn.active {
        background-color: var(--primary);
        color: white;
      }

      /* থিম টগল */
      .theme-toggle {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: var(--text-color);
        padding: 6px;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 20px;
        right: 20px;
      }

      .theme-toggle:hover {
        background-color: var(--card-bg);
      }

      /* ফেল করা শিক্ষার্থীদের তালিকা */
      .failed-students {
        margin-top: 20px;
      }

      .failed-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 8px;
        margin-top: 10px;
      }

      .failed-student {
        background-color: rgba(247, 37, 133, 0.1);
        padding: 12px;
        border-radius: 6px;
        border-left: 4px solid var(--danger);
        font-size: 0.85rem;
      }

      /* গ্রুপ পরিসংখ্যান */
      .group-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
        margin-top: 10px;
      }

      .group-stat-card {
        background-color: var(--card-bg);
        padding: 15px;
        border-radius: 6px;
        box-shadow: var(--card-shadow);
      }

      .group-stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-color);
      }

      .group-name {
        font-weight: bold;
        color: var(--heading-color);
        font-size: 0.9rem;
      }

      .pass-fail-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 8px;
      }

      .pass-count,
      .fail-count {
        text-align: center;
        padding: 8px;
        border-radius: 5px;
        width: 48%;
        font-size: 0.85rem;
      }

      .pass-count {
        background-color: rgba(76, 201, 240, 0.2);
        color: var(--success);
      }

      .fail-count {
        background-color: rgba(247, 37, 133, 0.2);
        color: var(--danger);
      }

      /* টেবিল ভিউ */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 0.9rem;
      }

      .data-table th,
      .data-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .data-table th {
        background-color: var(--card-bg);
        font-weight: 600;
        color: var(--heading-color);
      }

      .data-table tr:hover {
        background-color: var(--card-bg);
      }

      .view-toggle {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .view-btn {
        padding: 6px 12px;
        border-radius: 5px;
        background-color: var(--card-bg);
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.85rem;
      }

      .view-btn.active {
        background-color: var(--primary);
        color: white;
      }

      /* রেস্পন্সিভ ডিজাইন */
      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .chart-container {
          height: 300px;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        /* মোবাইলে হরাইজন্টাল বার চার্ট */
        .chart-container.horizontal-chart {
          height: 500px;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .card-title {
          font-size: 1.1rem;
        }

        .data-table {
          font-size: 0.8rem;
        }

        .data-table th,
        .data-table td {
          padding: 8px 5px;
        }
      }

      @media (max-width: 576px) {
        .stats {
          grid-template-columns: 1fr;
        }

        .group-stats-grid {
          grid-template-columns: 1fr;
        }

        .failed-list {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 1.2rem;
        }

        .data-table {
          display: block;
          overflow-x: auto;
          white-space: nowrap;
        }
      }

      /* অ্যানিমেশন */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out;
      }

      /* স্ক্রোলবার স্টাইল */
      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-track {
        background: var(--card-bg);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 15px;
      }

      /* JSON আপলোড স্টাইল */
      .json-upload {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .json-upload input[type='file'] {
        display: none;
      }

      .json-upload label {
        background-color: var(--info);
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.85rem;
      }

      .exam-info {
        background-color: var(--primary);
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
        margin-bottom: 15px;
        text-align: center;
        font-weight: bold;
        box-shadow: var(--card-shadow);
        font-size: 0.9rem;
      }

      /* JSON ডেটা প্রিভিউ */
      .json-preview {
        margin-top: 10px;
        padding: 10px;
        background-color: var(--card-bg);
        border-radius: 6px;
        max-height: 150px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 11px;
      }

      /* বার চার্টে মার্কস দেখানোর জন্য */
      .bar-value {
        font-weight: bold;
        font-size: 12px;
      }

      /* গ্রুপ কালার */
      .science-group {
        background-color: rgba(76, 201, 240, 0.1);
        border-left: 4px solid var(--science);
      }

      .business-group {
        background-color: rgba(114, 9, 183, 0.1);
        border-left: 4px solid var(--business);
      }

      .arts-group {
        background-color: rgba(248, 150, 30, 0.1);
        border-left: 4px solid var(--arts);
      }

      .compact-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }

      /* সার্চ এবং ফিল্টার স্টাইল */
      .search-filter-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
      }

      .search-box {
        position: relative;
      }

      .search-box i {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-color);
        opacity: 0.7;
      }

      .search-box input {
        width: 100%;
        padding-left: 35px;
      }

      .grade-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
      }

      .grade-btn {
        padding: 5px 10px;
        border-radius: 15px;
        background-color: var(--card-bg);
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.8rem;
        border: 1px solid var(--border-color);
      }

      .grade-btn.active {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .grade-A-plus {
        background-color: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
      }
      .grade-A {
        background-color: rgba(52, 152, 219, 0.2);
        color: #3498db;
      }
      .grade-A-minus {
        background-color: rgba(155, 89, 182, 0.2);
        color: #9b59b6;
      }
      .grade-B {
        background-color: rgba(241, 196, 15, 0.2);
        color: #f1c40f;
      }
      .grade-C {
        background-color: rgba(230, 126, 34, 0.2);
        color: #e67e22;
      }
      .grade-D {
        background-color: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
      }
      .grade-F {
        background-color: rgba(149, 165, 166, 0.2);
        color: #95a5a6;
      }

      .grade-btn.active.grade-A-plus {
        background-color: #2ecc71;
        color: white;
      }
      .grade-btn.active.grade-A {
        background-color: #3498db;
        color: white;
      }
      .grade-btn.active.grade-A-minus {
        background-color: #9b59b6;
        color: white;
      }
      .grade-btn.active.grade-B {
        background-color: #f1c40f;
        color: white;
      }
      .grade-btn.active.grade-C {
        background-color: #e67e22;
        color: white;
      }
      .grade-btn.active.grade-D {
        background-color: #e74c3c;
        color: white;
      }
      .grade-btn.active.grade-F {
        background-color: #95a5a6;
        color: white;
      }

      @media (max-width: 768px) {
        .compact-controls,
        .search-filter-container {
          grid-template-columns: 1fr;
        }
      }

      /* টেবিলে গ্রেড স্টাইল */
      .grade-cell {
        font-weight: bold;
        text-align: center;
        border-radius: 4px;
        padding: 4px 8px;
      }

      .status-cell {
        text-align: center;
        border-radius: 4px;
        padding: 4px 8px;
        font-weight: bold;
      }

      .status-pass {
        background-color: rgba(46, 204, 113, 0.2);
        color: #27ae60;
      }

      .status-fail {
        background-color: rgba(231, 76, 60, 0.2);
        color: #c0392b;
      }

      .status-absent {
        background-color: rgba(149, 165, 166, 0.2);
        color: #7f8c8d;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- হেডার -->

      <div class="header-controls">
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>

      <!-- পরীক্ষার তথ্য -->

      <!-- JSON আপলোড সেকশন -->
      <div class="card">
        <div class="card-header"></div>
        <div class="json-upload">
          <input type="file" id="jsonFileInput" accept=".json" />
          <label for="jsonFileInput">
            <i class="fas fa-upload"></i>
            JSON ডেটা আপলোড
          </label>
          <button id="loadSampleData">
            <i class="fas fa-database"></i>
            স্যাম্পল ডেটা লোড
          </button>
          <button id="clearData">
            <i class="fas fa-trash"></i>
            ডেটা ক্লিয়ার
          </button>
          <!-- Download Button -->
          <button
            id="exportBtn"
            class="flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition whitespace-nowrap shadow-sm h-[46px]"
          >
            <i class="fas fa-download text-sm"></i>
            রিপোর্ট ডাউনলোড
          </button>

            <!-- Search -->
            <div
              class="search-box flex items-center border border-gray-300 rounded-lg px-3 py-2.5 flex-1 min-w-0 bg-white shadow-sm h-[46px]"
            >
              <i class="fas fa-search text-gray-400 text-sm mr-2"></i>
              <input
                type="text"
                id="searchInput"
                placeholder="নাম বা রোল দিয়ে সার্চ..."
                class="flex-1 outline-none text-sm bg-transparent w-full placeholder-gray-500"
              />
            </div>
        </div>
        <div class="json-preview" id="jsonPreview">
          <!-- JSON ডেটা প্রিভিউ এখানে দেখানো হবে -->
        </div>
      </div>

      <!-- পরিসংখ্যান কার্ড -->
      <div class="stats" id="statsContainer">
        <!-- পরিসংখ্যান এখানে দেখানো হবে -->
      </div>

      <!-- ফিল্টার এবং কন্ট্রোল -->
      <div class="card bg-white rounded-xl shadow-sm">
        <div class="controls grid grid-cols-1 lg:grid-cols-2 lg:grid-rows-2 gap-4 md:gap-6">
          

           
         

          <!-- Right Top Row -->
          <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full justify-end">
            <!-- Chart Type -->

            <!-- Group Buttons -->
            <div class="group-filters flex items-center gap-2 overflow-x-auto py-1">
              <div
                class="group-btn active bg-blue-100 text-blue-800 border border-blue-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition whitespace-nowrap"
                data-group="all"
              >
                <i class="fas fa-users text-xs mr-1"></i>
                সব গ্রুপ
              </div>
              <div
                class="group-btn bg-cyan-100 text-cyan-800 border border-cyan-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition whitespace-nowrap"
                data-group="বিজ্ঞান গ্রুপ"
              >
                <i class="fas fa-flask text-xs mr-1"></i>
                বিজ্ঞান
              </div>
              <div
                class="group-btn bg-purple-100 text-purple-800 border border-purple-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition whitespace-nowrap"
                data-group="ব্যবসায় গ্রুপ"
              >
                <i class="fas fa-book text-xs mr-1"></i>
                ব্যবসায়
              </div>
              <div
                class="group-btn bg-amber-100 text-amber-800 border border-amber-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition whitespace-nowrap"
                data-group="মানবিক গ্রুপ"
              >
                <i class="fas fa-palette text-xs mr-1"></i>
                মানবিক
              </div>
            </div>
          </div>

          <!-- Bottom Full Row: Grade Filter -->
          <div
            class="grade-filter flex flex-wrap md:flex-nowrap items-center gap-2 overflow-x-auto py-1 w-full lg:col-span-2 lg:row-start-2 justify-center"
          >
            <div
              class="grade-btn active bg-blue-100 text-blue-800 border border-blue-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="all"
            >
              সব গ্রেড
            </div>
            <div
              class="grade-btn grade-A-plus bg-green-100 text-green-800 border border-green-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="A+"
            >
              A+
            </div>
            <div
              class="grade-btn grade-A bg-blue-100 text-blue-800 border border-blue-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="A"
            >
              A
            </div>
            <div
              class="grade-btn grade-A-minus bg-purple-100 text-purple-800 border border-purple-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="A-"
            >
              A-
            </div>
            <div
              class="grade-btn grade-B bg-yellow-100 text-yellow-800 border border-yellow-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="B"
            >
              B
            </div>
            <div
              class="grade-btn grade-C bg-orange-100 text-orange-800 border border-orange-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="C"
            >
              C
            </div>
            <div
              class="grade-btn grade-D bg-red-100 text-red-800 border border-red-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="D"
            >
              D
            </div>
            <div
              class="grade-btn grade-F bg-gray-100 text-gray-800 border border-gray-300 px-3 py-1.5 rounded-lg text-sm cursor-pointer shadow-sm hover:shadow transition"
              data-grade="F"
            >
              F
            </div>
          </div>

          <select
            id="chartType"
            class="border border-gray-300 rounded-lg px-3 py-2.5 text-sm cursor-pointer bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-[46px] w-full sm:w-auto"
          >
            <option value="total">মোট স্কোর অনুসারে</option>
            <option value="written">লিখিত পরীক্ষার স্কোর</option>
            <option value="mcq">এমসিকিউ স্কোর</option>
            <option value="practical">প্র্যাকটিক্যাল স্কোর</option>
          </select>

           <!-- Sort -->
            <select
              id="sortOrder"
              class="border border-gray-300 rounded-lg px-3 py-2.5 text-sm cursor-pointer bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-[46px] w-full sm:w-auto"
            >
              <option value="desc">সর্বোচ্চ থেকে সর্বনিম্ন</option>
              <option value="asc">সর্বনিম্ন থেকে সর্বোচ্চ</option>
            </select>
        </div>
      </div>

      <!-- প্রধান চার্ট -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title" id="chartTitle">মোট স্কোর র‌্যাঙ্কিং</h2>
          <div class="view-toggle">
            <div class="view-btn active" data-view="chart">
              <i class="fas fa-chart-bar"></i>
              চার্ট
            </div>
            <div class="view-btn" data-view="table">
              <i class="fas fa-table"></i>
              টেবিল
            </div>
          </div>
        </div>
        <div class="chart-container horizontal-chart" id="chartView">
          <canvas id="performanceChart"></canvas>
        </div>
        <div class="table-container" id="tableView" style="display: none">
          <table class="data-table" id="performanceTable">
            <thead>
              <tr>
                <th>রোল</th>
                <th>গ্রুপ</th>
                <th>লিখিত</th>
                <th>এমসিকিউ</th>
                <th>প্র্যাকটিক্যাল</th>
                <th>মোট</th>
                <th>গ্রেড</th>
                <th>স্ট্যাটাস</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- টেবিল ডেটা এখানে দেখানো হবে -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ফেল করা শিক্ষার্থীরা -->
      <div class="card failed-students">
        <div class="card-header">
          <h2 class="card-title">ফেল করা শিক্ষার্থী (লিখিত < ১৭)</h2>
        </div>
        <div class="failed-list" id="failedStudentsContainer">
          <!-- ফেল করা শিক্ষার্থীরা এখানে দেখানো হবে -->
        </div>
      </div>

      <!-- গ্রুপভিত্তিক পরিসংখ্যান -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">গ্রুপভিত্তিক পাস/ফেল পরিসংখ্যান</h2>
        </div>
        <div class="group-stats-grid" id="groupStatsContainer">
          <!-- গ্রুপ পরিসংখ্যান এখানে দেখানো হবে -->
        </div>
      </div>
    </div>

    <script>
      // শিক্ষার্থীদের ডেটা
      const defaultStudentData = [
        { id: 1, name: 'রোল 1', group: 'বিজ্ঞান গ্রুপ', written: 43, mcq: 20, practical: 22, total: 85 },
        { id: 2, name: 'রোল 2', group: 'বিজ্ঞান গ্রুপ', written: 40, mcq: 20, practical: 22, total: 82 },
        { id: 3, name: 'রোল 3', group: 'বিজ্ঞান গ্রুপ', written: 42, mcq: 20, practical: 22, total: 84 },
        { id: 4, name: 'রোল 4', group: 'বিজ্ঞান গ্রুপ', written: 44, mcq: 20, practical: 22, total: 86 },
        { id: 5, name: 'রোল 5', group: 'বিজ্ঞান গ্রুপ', written: 34, mcq: 20, practical: 22, total: 76 },
        { id: 6, name: 'রোল 6', group: 'বিজ্ঞান গ্রুপ', written: 7, mcq: 20, practical: 0, total: 27 },
        { id: 7, name: 'রোল 7', group: 'বিজ্ঞান গ্রুপ', written: 41, mcq: 20, practical: 22, total: 83 },

        { id: 8, name: 'রোল 8', group: 'ব্যবসায় গ্রুপ', written: 30, mcq: 20, practical: 22, total: 72 },
        { id: 9, name: 'রোল 9', group: 'ব্যবসায় গ্রুপ', written: 43, mcq: 20, practical: 22, total: 85 },
        { id: 10, name: 'রোল 10', group: 'ব্যবসায় গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 11, name: 'রোল 11', group: 'ব্যবসায় গ্রুপ', written: 42, mcq: 20, practical: 22, total: 84 },
        { id: 12, name: 'রোল 12', group: 'ব্যবসায় গ্রুপ', written: 41, mcq: 20, practical: 22, total: 83 },
        { id: 13, name: 'রোল 13', group: 'ব্যবসায় গ্রুপ', written: 37, mcq: 20, practical: 22, total: 79 },
        { id: 14, name: 'রোল 14', group: 'ব্যবসায় গ্রুপ', written: 36, mcq: 20, practical: 22, total: 78 },
        { id: 15, name: 'রোল 15', group: 'ব্যবসায় গ্রুপ', written: 38, mcq: 20, practical: 22, total: 80 },
        { id: 16, name: 'রোল 16', group: 'ব্যবসায় গ্রুপ', written: 28, mcq: 20, practical: 22, total: 70 },
        { id: 17, name: 'রোল 17', group: 'ব্যবসায় গ্রুপ', written: 28, mcq: 20, practical: 22, total: 70 },
        { id: 18, name: 'রোল 18', group: 'ব্যবসায় গ্রুপ', written: 25, mcq: 20, practical: 22, total: 67 },
        { id: 19, name: 'রোল 19', group: 'ব্যবসায় গ্রুপ', written: 24, mcq: 20, practical: 22, total: 66 },

        { id: 20, name: 'রোল 20', group: 'মানবিক গ্রুপ', written: 50, mcq: 20, practical: 22, total: 92 },
        { id: 21, name: 'রোল 21', group: 'মানবিক গ্রুপ', written: 47, mcq: 20, practical: 22, total: 89 },
        { id: 22, name: 'রোল 22', group: 'মানবিক গ্রুপ', written: 36, mcq: 20, practical: 22, total: 78 },
        { id: 23, name: 'রোল 23', group: 'মানবিক গ্রুপ', written: 39, mcq: 20, practical: 22, total: 81 },
        { id: 24, name: 'রোল 24', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 25, name: 'রোল 25', group: 'মানবিক গ্রুপ', written: 42, mcq: 20, practical: 22, total: 84 },
        { id: 26, name: 'রোল 26', group: 'মানবিক গ্রুপ', written: 38, mcq: 20, practical: 22, total: 80 },
        { id: 27, name: 'রোল 27', group: 'মানবিক গ্রুপ', written: 26, mcq: 20, practical: 22, total: 68 },
        { id: 28, name: 'রোল 28', group: 'মানবিক গ্রুপ', written: 44, mcq: 20, practical: 22, total: 86 },
        { id: 29, name: 'রোল 29', group: 'মানবিক গ্রুপ', written: 35, mcq: 20, practical: 22, total: 77 },
        { id: 30, name: 'রোল 30', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 31, name: 'রোল 31', group: 'মানবিক গ্রুপ', written: 38, mcq: 20, practical: 22, total: 80 },
        { id: 32, name: 'রোল 32', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 33, name: 'রোল 33', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 34, name: 'রোল 34', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 35, name: 'রোল 35', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 36, name: 'রোল 36', group: 'মানবিক গ্রুপ', written: 32, mcq: 20, practical: 22, total: 74 },
        { id: 37, name: 'রোল 37', group: 'মানবিক গ্রুপ', written: 24, mcq: 20, practical: 22, total: 66 },
        { id: 38, name: 'রোল 38', group: 'মানবিক গ্রুপ', written: 32, mcq: 20, practical: 22, total: 74 },
        { id: 39, name: 'রোল 39', group: 'মানবিক গ্রুপ', written: 35, mcq: 20, practical: 22, total: 77 },
        { id: 40, name: 'রোল 40', group: 'মানবিক গ্রুপ', written: 15, mcq: 20, practical: 0, total: 35 },
        { id: 41, name: 'রোল 41', group: 'মানবিক গ্রুপ', written: 31, mcq: 20, practical: 22, total: 73 },
        { id: 42, name: 'রোল 42', group: 'মানবিক গ্রুপ', written: 25, mcq: 20, practical: 22, total: 67 },
        { id: 43, name: 'রোল 43', group: 'মানবিক গ্রুপ', written: 27, mcq: 20, practical: 22, total: 69 },
        { id: 44, name: 'রোল 44', group: 'মানবিক গ্রুপ', written: 13, mcq: 20, practical: 0, total: 33 },
        { id: 45, name: 'রোল 45', group: 'মানবিক গ্রুপ', written: 15, mcq: 20, practical: 0, total: 35 },
        { id: 46, name: 'রোল 46', group: 'মানবিক গ্রুপ', written: 21, mcq: 20, practical: 22, total: 63 },
        { id: 47, name: 'রোল 47', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 48, name: 'রোল 48', group: 'মানবিক গ্রুপ', written: 0, mcq: 0, practical: 0, total: 0 },
        { id: 49, name: 'রোল 49', group: 'মানবিক গ্রুপ', written: 12, mcq: 20, practical: 0, total: 32 },
        { id: 50, name: 'রোল 50', group: 'মানবিক গ্রুপ', written: 25, mcq: 20, practical: 22, total: 67 },
        { id: 51, name: 'রোল 51', group: 'মানবিক গ্রুপ', written: 14, mcq: 20, practical: 0, total: 34 },
        { id: 52, name: 'রোল 52', group: 'মানবিক গ্রুপ', written: 17, mcq: 20, practical: 22, total: 59 },
      ];

      // বাংলাদেশী গ্রেডিং সিস্টেম
      const gradingSystem = [
        { min: 80, max: 100, grade: 'A+', point: 5.0 },
        { min: 70, max: 79, grade: 'A', point: 4.0 },
        { min: 60, max: 69, grade: 'A-', point: 3.5 },
        { min: 50, max: 59, grade: 'B', point: 3.0 },
        { min: 40, max: 49, grade: 'C', point: 2.0 },
        { min: 33, max: 39, grade: 'D', point: 1.0 },
        { min: 0, max: 32, grade: 'F', point: 0.0 },
      ];

      // গ্লোবাল ভেরিয়েবল
      let studentData = [];
      let currentChart = null;
      let currentGroupFilter = 'all';
      let currentGradeFilter = 'all';
      let currentSearchTerm = '';
      let currentView = 'chart';

      // DOM এলিমেন্ট
      const chartTypeSelect = document.getElementById('chartType');
      const sortOrderSelect = document.getElementById('sortOrder');
      const exportBtn = document.getElementById('exportBtn');
      const groupFilters = document.querySelectorAll('.group-btn');
      const gradeFilters = document.querySelectorAll('.grade-btn');
      const searchInput = document.getElementById('searchInput');
      const statsContainer = document.getElementById('statsContainer');
      const groupStatsContainer = document.getElementById('groupStatsContainer');
      const failedStudentsContainer = document.getElementById('failedStudentsContainer');
      const chartCanvas = document.getElementById('performanceChart');
      const themeToggle = document.getElementById('themeToggle');
      const chartTitle = document.getElementById('chartTitle');
      const jsonFileInput = document.getElementById('jsonFileInput');
      const loadSampleDataBtn = document.getElementById('loadSampleData');
      const clearDataBtn = document.getElementById('clearData');
      const jsonPreview = document.getElementById('jsonPreview');
      const chartView = document.getElementById('chartView');
      const tableView = document.getElementById('tableView');
      const tableBody = document.getElementById('tableBody');
      const viewButtons = document.querySelectorAll('.view-btn');

      // অ্যাপ্লিকেশন ইনিশিয়ালাইজেশন
      function init() {
        // লোকাল স্টোরেজ থেকে ডেটা লোড করুন
        loadDataFromLocalStorage();

        chartTypeSelect.addEventListener('change', updateViews);
        sortOrderSelect.addEventListener('change', updateViews);
        exportBtn.addEventListener('click', exportChart);
        themeToggle.addEventListener('click', toggleTheme);
        jsonFileInput.addEventListener('change', handleFileUpload);
        loadSampleDataBtn.addEventListener('click', loadSampleData);
        clearDataBtn.addEventListener('click', clearData);
        searchInput.addEventListener('input', handleSearch);

        // গ্রুপ ফিল্টারে ইভেন্ট লিসেনার যোগ করুন
        groupFilters.forEach((btn) => {
          btn.addEventListener('click', function () {
            // সব বাটন থেকে active ক্লাস সরান
            groupFilters.forEach((b) => b.classList.remove('active'));
            // ক্লিক করা বাটনে active ক্লাস যোগ করুন
            this.classList.add('active');
            currentGroupFilter = this.getAttribute('data-group');
            updateViews();
          });
        });

        // গ্রেড ফিল্টারে ইভেন্ট লিসেনার যোগ করুন
        gradeFilters.forEach((btn) => {
          btn.addEventListener('click', function () {
            // সব বাটন থেকে active ক্লাস সরান
            gradeFilters.forEach((b) => b.classList.remove('active'));
            // ক্লিক করা বাটনে active ক্লাস যোগ করুন
            this.classList.add('active');
            currentGradeFilter = this.getAttribute('data-grade');
            updateViews();
          });
        });

        // ভিউ টগল বাটনে ইভেন্ট লিসেনার যোগ করুন
        viewButtons.forEach((btn) => {
          btn.addEventListener('click', function () {
            // সব বাটন থেকে active ক্লাস সরান
            viewButtons.forEach((b) => b.classList.remove('active'));
            // ক্লিক করা বাটনে active ক্লাস যোগ করুন
            this.classList.add('active');
            currentView = this.getAttribute('data-view');
            toggleView();
          });
        });

        // প্রাথমিক ডেটা লোড করুন
        updateViews();
      }

      // অনুপস্থিত শিক্ষার্থী চেক করুন
      function isAbsent(student) {
        return student.written === 0 && student.mcq === 0 && student.practical === 0;
      }

      // গ্রেড গণনা করুন
      function calculateGrade(total) {
        for (let i = 0; i < gradingSystem.length; i++) {
          if (total >= gradingSystem[i].min && total <= gradingSystem[i].max) {
            return {
              grade: gradingSystem[i].grade,
              point: gradingSystem[i].point,
            };
          }
        }
        return { grade: 'F', point: 0.0 };
      }

      // স্ট্যাটাস নির্ধারণ করুন (পাস/ফেল/অনুপস্থিত)
      function determineStatus(student) {
        // অনুপস্থিত হলে
        if (isAbsent(student)) {
          return 'অনুপস্থিত';
        }

        // লিখিত পরীক্ষায় ১৭ এর কম পেলে ফেল
        if (student.written < 17) {
          return 'ফেল';
        }

        // মোট মার্কস ৩৩ এর কম হলে ফেল
        const gradeInfo = calculateGrade(student.total);
        if (gradeInfo.grade === 'F') {
          return 'ফেল';
        }

        return 'পাস';
      }

      // ভিউ টগল করুন
      function toggleView() {
        if (currentView === 'chart') {
          chartView.style.display = 'block';
          tableView.style.display = 'none';
          updateChart();
        } else {
          chartView.style.display = 'none';
          tableView.style.display = 'block';
          updateTable();
        }
      }

      // সার্চ হ্যান্ডেল করুন
      function handleSearch(event) {
        currentSearchTerm = event.target.value.toLowerCase();
        updateViews();
      }

      // লোকাল স্টোরেজ থেকে ডেটা লোড করুন
      function loadDataFromLocalStorage() {
        const savedData = localStorage.getItem('studentPerformanceData');
        if (savedData) {
          try {
            studentData = JSON.parse(savedData);
            updateJSONPreview();
            showNotification('ডেটা লোকাল স্টোরেজ থেকে লোড করা হয়েছে');
          } catch (e) {
            console.error('ডেটা পার্স করতে সমস্যা:', e);
            loadSampleData();
          }
        } else {
          loadSampleData();
        }
      }

      // লোকাল স্টোরেজে ডেটা সংরক্ষণ করুন
      function saveDataToLocalStorage() {
        localStorage.setItem('studentPerformanceData', JSON.stringify(studentData));
      }

      // JSON আপলোড হ্যান্ডেল করুন
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const jsonData = JSON.parse(e.target.result);
            if (Array.isArray(jsonData)) {
              studentData = jsonData;
              saveDataToLocalStorage();
              updateJSONPreview();
              updateViews();
              showNotification('JSON ডেটা সফলভাবে আপলোড হয়েছে');
            } else {
              throw new Error('ডেটা অ্যারে ফরম্যাটে হতে হবে');
            }
          } catch (error) {
            alert('ভুল JSON ফরম্যাট: ' + error.message);
          }
        };
        reader.readAsText(file);

        // ফাইল ইনপুট রিসেট করুন
        event.target.value = '';
      }

      // স্যাম্পল ডেটা লোড করুন
      function loadSampleData() {
        studentData = [...defaultStudentData];
        saveDataToLocalStorage();
        updateJSONPreview();
        updateViews();
        showNotification('স্যাম্পল ডেটা লোড করা হয়েছে');
      }

      // ডেটা ক্লিয়ার করুন
      function clearData() {
        if (confirm('আপনি কি নিশ্চিত যে আপনি সমস্ত ডেটা মুছতে চান?')) {
          studentData = [];
          saveDataToLocalStorage();
          updateJSONPreview();
          updateViews();
          showNotification('সমস্ত ডেটা মুছে ফেলা হয়েছে');
        }
      }

      // JSON প্রিভিউ আপডেট করুন
      function updateJSONPreview() {
        if (studentData.length > 0) {
          jsonPreview.textContent =
            JSON.stringify(studentData.slice(0, 3), null, 2) + (studentData.length > 3 ? '\n...' : '');
        } else {
          jsonPreview.textContent = 'কোনো ডেটা নেই';
        }
      }

      // সব ভিউ আপডেট করুন
      function updateViews() {
        updateStats();
        updateChart();
        updateTable();
        updateGroupStats();
        updateFailedStudents();
      }

      // ফিল্টার্ড ডেটা পান
      function getFilteredData() {
        let filteredData = [...studentData];

        // গ্রুপ দ্বারা ফিল্টার করুন
        if (currentGroupFilter !== 'all') {
          filteredData = filteredData.filter((student) => student.group === currentGroupFilter);
        }

        // সার্চ টার্ম দ্বারা ফিল্টার করুন
        if (currentSearchTerm) {
          filteredData = filteredData.filter(
            (student) =>
              student.name.toLowerCase().includes(currentSearchTerm) ||
              student.id.toString().includes(currentSearchTerm)
          );
        }

        // গ্রেড দ্বারা ফিল্টার করুন
        if (currentGradeFilter !== 'all') {
          filteredData = filteredData.filter((student) => {
            const gradeInfo = calculateGrade(student.total);
            return gradeInfo.grade === currentGradeFilter;
          });
        }

        return filteredData;
      }

      // বর্তমান নির্বাচন অনুযায়ী চার্ট আপডেট করুন
      function updateChart() {
        if (studentData.length === 0 || currentView !== 'chart') {
          // চার্ট ক্লিয়ার করুন যদি কোনো ডেটা না থাকে
          if (currentChart) {
            currentChart.destroy();
            currentChart = null;
          }
          return;
        }

        // ফিল্টার্ড ডেটা পান
        let filteredData = getFilteredData();

        // ডেটা সাজান
        const chartType = chartTypeSelect.value;
        const sortOrder = sortOrderSelect.value;

        let sortedData = [...filteredData];
        if (chartType === 'total') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.total - a.total : a.total - b.total));
          chartTitle.textContent = 'মোট স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'written') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.written - a.written : a.written - b.written));
          chartTitle.textContent = 'লিখিত পরীক্ষার স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'mcq') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.mcq - a.mcq : a.mcq - b.mcq));
          chartTitle.textContent = 'এমসিকিউ স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'practical') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.practical - a.practical : a.practical - b.practical));
          chartTitle.textContent = 'প্র্যাকটিক্যাল পরীক্ষার স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        }

        // ভাল ভিজুয়ালাইজেশনের জন্য শীর্ষ 30-এ সীমাবদ্ধ করুন
        if (sortedData.length > 30) {
          sortedData = sortedData.slice(0, 30);
        }

        // চার্ট ডেটা প্রস্তুত করুন
        const labels = sortedData.map((student) => student.name);
        let data = [];
        let backgroundColor = [];
        let borderColor = [];
        let chartLabel = '';

        if (chartType === 'total') {
          data = sortedData.map((student) => student.total);
          chartLabel = 'মোট স্কোর';
          backgroundColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 0.7)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 0.7)';
            return 'rgba(248, 150, 30, 0.7)';
          });
          borderColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 1)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 1)';
            return 'rgba(248, 150, 30, 1)';
          });
        } else if (chartType === 'written') {
          data = sortedData.map((student) => student.written);
          chartLabel = 'লিখিত পরীক্ষার স্কোর';
          backgroundColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 0.7)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 0.7)';
            return 'rgba(248, 150, 30, 0.7)';
          });
          borderColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 1)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 1)';
            return 'rgba(248, 150, 30, 1)';
          });
        } else if (chartType === 'mcq') {
          data = sortedData.map((student) => student.mcq);
          chartLabel = 'এমসিকিউ স্কোর (২০-এর মধ্যে)';
          backgroundColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 0.7)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 0.7)';
            return 'rgba(248, 150, 30, 0.7)';
          });
          borderColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 1)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 1)';
            return 'rgba(248, 150, 30, 1)';
          });
        } else if (chartType === 'practical') {
          data = sortedData.map((student) => student.practical);
          chartLabel = 'প্র্যাকটিক্যাল পরীক্ষার স্কোর';
          backgroundColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 0.7)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 0.7)';
            return 'rgba(248, 150, 30, 0.7)';
          });
          borderColor = sortedData.map((student) => {
            if (student.group === 'বিজ্ঞান গ্রুপ') return 'rgba(76, 201, 240, 1)';
            if (student.group === 'ব্যবসায় গ্রুপ') return 'rgba(114, 9, 183, 1)';
            return 'rgba(248, 150, 30, 1)';
          });
        }

        // পূর্ববর্তী চার্ট ধ্বংস করুন যদি বিদ্যমান থাকে
        if (currentChart) {
          currentChart.destroy();
        }

        // মোবাইল ডিভাইসে হরাইজন্টাল বার চার্ট ব্যবহার করুন
        const isMobile = window.innerWidth <= 768;

        // নতুন চার্ট তৈরি করুন
        const ctx = chartCanvas.getContext('2d');
        currentChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: chartLabel,
                data: data,
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                borderWidth: 1,
              },
            ],
          },
          options: {
            indexAxis: isMobile ? 'y' : 'x', // মোবাইলে হরাইজন্টাল
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: isMobile ? 'শিক্ষার্থীরা' : 'স্কোর',
                },
                grid: {
                  color: 'rgba(128, 128, 128, 0.1)',
                },
              },
              x: {
                title: {
                  display: true,
                  text: isMobile ? 'স্কোর' : 'শিক্ষার্থীরা',
                },
                ticks: {
                  maxRotation: isMobile ? 0 : 45,
                  minRotation: isMobile ? 0 : 45,
                  color: 'rgba(128, 128, 128, 0.8)',
                },
                grid: {
                  color: 'rgba(128, 128, 128, 0.1)',
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: 'rgba(128, 128, 128, 0.8)',
                },
              },
              tooltip: {
                callbacks: {
                  afterLabel: function (context) {
                    const student = sortedData[context.dataIndex];
                    let tooltipText = `গ্রুপ: ${student.group}`;
                    // লিখিত মার্কস < 17 এর জন্য ফেল সতর্কতা যোগ করুন
                    if (chartType === 'written' && student.written < 17) {
                      tooltipText += '\n❌ ফেল (লিখিত < ১৭)';
                    }
                    return tooltipText;
                  },
                },
              },
            },
          },
        });
      }

      // টেবিল ভিউ আপডেট করুন
      function updateTable() {
        if (studentData.length === 0 || currentView !== 'table') {
          tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">কোনো ডেটা নেই</td></tr>';
          return;
        }

        // ফিল্টার্ড ডেটা পান
        let filteredData = getFilteredData();

        // ডেটা সাজান
        const chartType = chartTypeSelect.value;
        const sortOrder = sortOrderSelect.value;

        let sortedData = [...filteredData];
        if (chartType === 'total') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.total - a.total : a.total - b.total));
          chartTitle.textContent = 'মোট স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'written') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.written - a.written : a.written - b.written));
          chartTitle.textContent = 'লিখিত পরীক্ষার স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'mcq') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.mcq - a.mcq : a.mcq - b.mcq));
          chartTitle.textContent = 'এমসিকিউ স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        } else if (chartType === 'practical') {
          sortedData.sort((a, b) => (sortOrder === 'desc' ? b.practical - a.practical : a.practical - b.practical));
          chartTitle.textContent = 'প্র্যাকটিক্যাল পরীক্ষার স্কোর র‌্যাঙ্কিং - প্রি-টেস্ট পরীক্ষা-২০২৫';
        }

        // ভাল ভিজুয়ালাইজেশনের জন্য শীর্ষ 30-এ সীমাবদ্ধ করুন
        if (sortedData.length > 30) {
          sortedData = sortedData.slice(0, 30);
        }

        // টেবিল বডি আপডেট করুন
        tableBody.innerHTML = sortedData
          .map((student, index) => {
            const rowClass =
              student.group === 'বিজ্ঞান গ্রুপ'
                ? 'science-group'
                : student.group === 'ব্যবসায় গ্রুপ'
                ? 'business-group'
                : 'arts-group';

            const gradeInfo = calculateGrade(student.total);
            const status = determineStatus(student);
            const statusClass = status === 'পাস' ? 'status-pass' : status === 'ফেল' ? 'status-fail' : 'status-absent';

            return `
                    <tr class="${rowClass}">
                        <td>${student.name}</td>
                        <td>${student.group}</td>
                        <td>${student.written}</td>
                        <td>${student.mcq}</td>
                        <td>${student.practical}</td>
                        <td><strong>${student.total}</strong></td>
                        <td><span class="grade-cell grade-${gradeInfo.grade
                          .replace('+', '-plus')
                          .replace('-', '-minus')}">${gradeInfo.grade}</span></td>
                        <td><span class="status-cell ${statusClass}">${status}</span></td>
                    </tr>
                `;
          })
          .join('');
      }

      // পরিসংখ্যান আপডেট করুন
      function updateStats() {
        if (studentData.length === 0) {
          statsContainer.innerHTML = `
                    <div class="stat-card fade-in">
                        <div class="stat-value">0</div>
                        <div class="stat-label">মোট শিক্ষার্থী</div>
                    </div>
                    <div class="stat-card fade-in">
                        <div class="stat-value">0</div>
                        <div class="stat-label">অনুপস্থিত</div>
                    </div>
                    <div class="stat-card fade-in">
                        <div class="stat-value" style="color: var(--danger)">0</div>
                        <div class="stat-label">ফেল করেছে</div>
                    </div>
                    <div class="stat-card fade-in">
                        <div class="stat-value" style="color: var(--success)">0</div>
                        <div class="stat-label">পাস করেছে</div>
                    </div>
                    <div class="stat-card fade-in">
                        <div class="stat-value" style="color: var(--info)">0</div>
                        <div class="stat-label">পরীক্ষার্থী সংখ্যা</div>
                    </div>
                `;
          return;
        }

        // ফিল্টার্ড ডেটা পান
        let filteredData = getFilteredData();

        // পরিসংখ্যান গণনা করুন
        const totalStudents = filteredData.length;
        const absentStudents = filteredData.filter((student) => isAbsent(student)).length;

        // ফেল করেছে - অনুপস্থিতদের বাদ দিয়ে
        const failedStudents = filteredData.filter(
          (student) => !isAbsent(student) && (student.written < 17 || calculateGrade(student.total).grade === 'F')
        ).length;

        // পাস করেছে - অনুপস্থিতদের বাদ দিয়ে
        const passedStudents = filteredData.filter(
          (student) => !isAbsent(student) && student.written >= 17 && calculateGrade(student.total).grade !== 'F'
        ).length;

        const participants = totalStudents - absentStudents;

        // পরিসংখ্যান কন্টেইনার আপডেট করুন
        statsContainer.innerHTML = `
                <div class="stat-card fade-in">
                    <div class="stat-value">${totalStudents}</div>
                    <div class="stat-label">মোট শিক্ষার্থী</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-value">${absentStudents}</div>
                    <div class="stat-label">অনুপস্থিত</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-value" style="color: var(--danger)">${failedStudents}</div>
                    <div class="stat-label">ফেল করেছে</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-value" style="color: var(--success)">${passedStudents}</div>
                    <div class="stat-label">পাস করেছে</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-value" style="color: var(--info)">${participants}</div>
                    <div class="stat-label">পরীক্ষার্থী সংখ্যা</div>
                </div>
            `;
      }

      // গ্রুপভিত্তিক পাস/ফেল পরিসংখ্যান আপডেট করুন
      function updateGroupStats() {
        if (studentData.length === 0) {
          groupStatsContainer.innerHTML = '<div class="group-stat-card fade-in">কোনো ডেটা নেই</div>';
          return;
        }

        // ইউনিক গ্রুপ পান
        const groups = [...new Set(studentData.map((student) => student.group))];

        // প্রতিটি গ্রুপের জন্য পাস/ফেল গণনা করুন
        const groupStats = groups.map((group) => {
          const groupStudents = studentData.filter((student) => student.group === group);
          const totalStudents = groupStudents.length;
          const absentStudents = groupStudents.filter((student) => isAbsent(student)).length;

          // ফেল করেছে - অনুপস্থিতদের বাদ দিয়ে
          const failedStudents = groupStudents.filter(
            (student) => !isAbsent(student) && (student.written < 17 || calculateGrade(student.total).grade === 'F')
          ).length;

          // পাস করেছে - অনুপস্থিতদের বাদ দিয়ে
          const passedStudents = groupStudents.filter(
            (student) => !isAbsent(student) && student.written >= 17 && calculateGrade(student.total).grade !== 'F'
          ).length;

          const participants = totalStudents - absentStudents;

          return {
            group,
            totalStudents,
            absentStudents,
            failedStudents,
            passedStudents,
            participants,
          };
        });

        // গ্রুপ পরিসংখ্যান কন্টেইনার আপডেট করুন
        groupStatsContainer.innerHTML = groupStats
          .map((stat) => {
            let groupClass = '';
            if (stat.group === 'বিজ্ঞান গ্রুপ') groupClass = 'science-group';
            else if (stat.group === 'ব্যবসায় গ্রুপ') groupClass = 'business-group';
            else groupClass = 'arts-group';

            return `
                        <div class="group-stat-card fade-in ${groupClass}">
                            <div class="group-stat-header">
                                <span class="group-name">${stat.group}</span>
                                <span>মোট: ${stat.totalStudents}</span>
                            </div>
                            <div>অনুপস্থিত: ${stat.absentStudents}</div>
                            <div>পরীক্ষার্থী: ${stat.participants}</div>
                            <div class="pass-fail-stats">
                                <div class="pass-count">
                                    <div class="stat-value">${stat.passedStudents}</div>
                                    <div class="stat-label">পাস করেছে</div>
                                </div>
                                <div class="fail-count">
                                    <div class="stat-value">${stat.failedStudents}</div>
                                    <div class="stat-label">ফেল করেছে</div>
                                </div>
                            </div>
                        </div>
                    `;
          })
          .join('');
      }

      // ফেল করা শিক্ষার্থীদের তালিকা আপডেট করুন
      function updateFailedStudents() {
        if (studentData.length === 0) {
          failedStudentsContainer.innerHTML = '<div class="failed-student fade-in">কোনো ডেটা নেই</div>';
          return;
        }

        // ফিল্টার্ড ডেটা পান
        let filteredData = getFilteredData();

        // ফেল করা শিক্ষার্থীদের পান (লিখিত < 17 অথবা মোট মার্কস ৩৩ এর কম) - অনুপস্থিতদের বাদ দিয়ে
        const failedStudents = filteredData.filter(
          (student) => !isAbsent(student) && (student.written < 17 || calculateGrade(student.total).grade === 'F')
        );

        // ফেল করা শিক্ষার্থী কন্টেইনার আপডেট করুন
        if (failedStudents.length > 0) {
          failedStudentsContainer.innerHTML = failedStudents
            .map((student) => {
              let groupClass = '';
              if (student.group === 'বিজ্ঞান গ্রুপ') groupClass = 'science-group';
              else if (student.group === 'ব্যবসায় গ্রুপ') groupClass = 'business-group';
              else groupClass = 'arts-group';

              const gradeInfo = calculateGrade(student.total);
              const failReason = student.written < 17 ? 'লিখিত < ১৭' : 'মোট মার্কস < ৩৩';

              return `
                            <div class="failed-student fade-in ${groupClass}">
                                <strong>${student.name}</strong><br>
                                গ্রুপ: ${student.group}<br>
                                লিখিত: ${student.written}<br>
                                এমসিকিউ: ${student.mcq}<br>
                                প্র্যাকটিক্যাল: ${student.practical}<br>
                                মোট: ${student.total}<br>
                                গ্রেড: ${gradeInfo.grade}<br>
                                <strong style="color: var(--danger)">ফেল কারণ: ${failReason}</strong>
                            </div>
                        `;
            })
            .join('');
        } else {
          failedStudentsContainer.innerHTML =
            '<div class="failed-student fade-in">এই গ্রুপে কোনো ফেল করা শিক্ষার্থী নেই</div>';
        }
      }

      // চার্টকে ইমেজ হিসেবে এক্সপোর্ট করুন
      function exportChart() {
        if (currentChart) {
          const link = document.createElement('a');
          link.download = 'প্রি-টেস্ট-পরীক্ষা-২০২৫-পারফর্ম্যান্স-চার্ট.png';
          link.href = chartCanvas.toDataURL('image/png');
          link.click();
        }
      }

      // ডার্ক/লাইট মোড টগল করুন
      function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const icon = themeToggle.querySelector('i');
        if (document.body.classList.contains('dark-mode')) {
          icon.className = 'fas fa-sun';
        } else {
          icon.className = 'fas fa-moon';
        }

        // থিম পরিবর্তন প্রতিফলিত করতে চার্ট আপডেট করুন
        if (currentChart) {
          currentChart.update();
        }
      }

      // নোটিফিকেশন দেখান
      function showNotification(message) {
        // একটি সাধারণ নোটিফিকেশন তৈরি করুন
        const notification = document.createElement('div');
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 12px 16px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: fadeIn 0.5s, fadeOut 0.5s 2.5s forwards;
                font-size: 0.9rem;
            `;
        notification.textContent = message;
        document.body.appendChild(notification);

        // 3 সেকেন্ড পরে নোটিফিকেশন সরান
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }

      // রিসাইজ ইভেন্টে চার্ট আপডেট করুন
      window.addEventListener('resize', function () {
        if (currentChart) {
          updateChart();
        }
      });

      // DOM লোড হলে অ্যাপ ইনিশিয়ালাইজ করুন
      document.addEventListener('DOMContentLoaded', init);
    </script>
  </body>
</html>
